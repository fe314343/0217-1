<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 å¥½é‹æ”¾é¦¬ä¾† - ç´…æ¦œç”¢ç”Ÿå™¨ (ä¸‹æ‹‰é¸å–®ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700;900&display=swap');
        body { font-family: 'Noto Serif TC', serif; background-color: #1a1a1a; color: white; }
        canvas { border-radius: 0.5rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7); background-color: #801212; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d97706; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        
        /* è‡ªè¨‚ä¸‹æ‹‰é¸å–®ç®­é ­é¡è‰² */
        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23fbbf24'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.5em;
        }
    </style>
</head>
<body class="p-4 md:p-10">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ============================================================
        // ğŸ–¼ï¸ é è¨­åº•åœ–é…ç½®å€
        // ============================================================
        const DEFAULT_BG_URL = "https://cdn.jsdelivr.net/gh/zxc1234z004/imgup@main/images/20260217_005458_793.png"; 
        // ============================================================

        const Icon = ({ name, size = 20, className = "" }) => {
            const containerRef = useRef(null);
            useEffect(() => {
                if (window.lucide && containerRef.current) {
                    containerRef.current.innerHTML = '';
                    const i = document.createElement('i');
                    i.setAttribute('data-lucide', name);
                    i.className = className;
                    i.style.width = `${size}px`;
                    i.style.height = `${size}px`;
                    containerRef.current.appendChild(i);
                    window.lucide.createIcons();
                }
            }, [name, size, className]);
            return <span ref={containerRef} className="inline-flex items-center justify-center leading-none" />;
        };

        const App = () => {
            // çé …æ¨™é¡Œæ”¹ç‚ºä¸‹æ‹‰å¼é¸å–®é è¨­å€¼
            const [prizeName, setPrizeName] = useState("ğŸ§§ ç¬¬ä¸€æ¬¡ 200äºº");
            const [winnerText, setWinnerText] = useState("");
            const [bgUrl, setBgUrl] = useState(""); 
            const [customBg, setCustomBg] = useState(null); 
            const [isLoading, setIsLoading] = useState(false);
            const [canvasSize] = useState({ width: 1920, height: 1080 });
            const canvasRef = useRef(null);

            // åˆå§‹è¼‰å…¥é è¨­åº•åœ–
            useEffect(() => {
                if (DEFAULT_BG_URL && DEFAULT_BG_URL.trim() !== "") {
                    loadSpecificUrl(DEFAULT_BG_URL);
                }
            }, []);

            const loadSpecificUrl = (url) => {
                setIsLoading(true);
                const img = new Image();
                img.crossOrigin = "anonymous"; 
                img.onload = () => {
                    setCustomBg(img);
                    setIsLoading(false);
                };
                img.onerror = () => {
                    console.error("åº•åœ–è¼‰å…¥å¤±æ•—");
                    setIsLoading(false);
                };
                img.src = url;
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => {
                            setCustomBg(img);
                            setBgUrl(""); 
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };

            const loadUrlImage = () => {
                if (!bgUrl) return;
                loadSpecificUrl(bgUrl);
            };

            const drawImage = () => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                const { width, height } = canvas;

                ctx.clearRect(0, 0, width, height);
                if (customBg) {
                    ctx.drawImage(customBg, 0, 0, width, height);
                } else {
                    ctx.fillStyle = "#801212"; 
                    ctx.fillRect(0, 0, width, height);
                    ctx.fillStyle = "rgba(255,255,255,0.2)";
                    ctx.font = "bold 50px 'Noto Serif TC'";
                    ctx.textAlign = "center";
                    ctx.fillText("è¼‰å…¥åº•åœ–ä¸­...", width / 2, height / 2);
                }

                ctx.shadowColor = "rgba(0, 0, 0, 0.8)";
                ctx.shadowBlur = 8;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;

                ctx.textAlign = "center";
                ctx.fillStyle = "#ffffff";
                ctx.font = "bold 80px 'Noto Serif TC'";
                ctx.fillText(`â€” ${prizeName} â€”`, width / 2, 180);

                const winners = winnerText.split('\n').filter(name => name.trim() !== "");
                const count = winners.length;
                ctx.fillStyle = "#fbbf24"; 
                
                let startY = 320;
                let cols = 1;
                let fontSize = 70;
                let rowGap = 100;

                if (count > 32) {
                    cols = 5; fontSize = 38; rowGap = 75; startY = 320;
                } else if (count > 20) {
                    cols = 4; fontSize = 42; rowGap = 85; startY = 310;
                } else if (count > 10) {
                    cols = 2; fontSize = 55; rowGap = 95; startY = 300;
                } else {
                    cols = 1; fontSize = 70; rowGap = 110; startY = 340;
                }

                ctx.font = `bold ${fontSize}px 'Noto Serif TC'`;
                const itemsPerCol = Math.ceil(count / cols);
                const colWidth = width / (cols + 1);

                winners.forEach((name, i) => {
                    const colIndex = Math.floor(i / itemsPerCol);
                    const rowIndex = i % itemsPerCol;
                    const x = (colIndex + 1) * colWidth;
                    const y = startY + (rowIndex * rowGap);
                    ctx.fillText(name.trim(), x, y);
                });

                ctx.shadowBlur = 0;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;
                ctx.fillStyle = "rgba(251, 191, 36, 0.5)";
                ctx.font = "20px 'Inter'";
                ctx.fillText(`Generated by 2026 Lottery System â€¢ ${new Date().toLocaleString()}`, width / 2, height - 50);
            };

            useEffect(() => {
                const timer = setTimeout(drawImage, 150);
                return () => clearTimeout(timer);
            }, [prizeName, winnerText, customBg]);

            const downloadImage = () => {
                const canvas = canvasRef.current;
                const link = document.createElement('a');
                link.download = `ä¸­çç´…æ¦œ_${prizeName.replace('ğŸ§§ ', '')}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
            };

            return (
                <div className="max-w-7xl mx-auto flex flex-col gap-10">
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div className="bg-red-950/60 p-8 rounded-[2.5rem] border border-red-500/20 backdrop-blur-md space-y-6">
                            <div className="flex items-center gap-3 mb-4">
                                <Icon name="settings" className="text-amber-400" size={24} />
                                <h2 className="text-2xl font-black text-amber-400">æ“ä½œè¨­å®š</h2>
                            </div>

                            <div className="space-y-4">
                                <div className="space-y-2">
                                    <label className="block text-xs font-black text-amber-200/50 uppercase tracking-widest ml-1">1. åº•åœ–ç¶²å€ (é¸å¡«)</label>
                                    <div className="flex gap-2">
                                        <input 
                                            type="text" 
                                            className="flex-1 bg-black/40 border border-white/10 rounded-xl px-4 py-2 text-white focus:border-amber-500 outline-none text-sm"
                                            placeholder="æ›´æ›åº•åœ–ç¶²å€..."
                                            value={bgUrl}
                                            onChange={(e) => setBgUrl(e.target.value)}
                                        />
                                        <button onClick={loadUrlImage} disabled={isLoading || !bgUrl} className="bg-amber-600 hover:bg-amber-500 disabled:bg-gray-700 text-red-950 font-bold px-4 rounded-xl text-sm transition-colors">è¼‰å…¥</button>
                                    </div>
                                </div>

                                <div className="space-y-2">
                                    <label className="block text-xs font-black text-amber-200/50 uppercase tracking-widest ml-1">2. é¸æ“‡çé …æ¨™é¡Œ</label>
                                    <select 
                                        className="w-full bg-black/40 border border-white/10 rounded-2xl px-4 py-3 text-white focus:border-amber-500 outline-none font-bold text-lg appearance-none cursor-pointer"
                                        value={prizeName}
                                        onChange={(e) => setPrizeName(e.target.value)}
                                    >
                                        <option value="ğŸ§§ ç¬¬ä¸€æ¬¡ 200äºº">ğŸ§§ ç¬¬ä¸€æ¬¡ 200äºº</option>
                                        <option value="ğŸ§§ ç¬¬äºŒæ¬¡ 200äºº">ğŸ§§ ç¬¬äºŒæ¬¡ 200äºº</option>
                                        <option value="ğŸ§§ ç¬¬ä¸‰æ¬¡ 145äºº">ğŸ§§ ç¬¬ä¸‰æ¬¡ 145äºº</option>
                                    </select>
                                </div>

                                <div className="space-y-2">
                                    <label className="block text-xs font-black text-amber-200/50 uppercase tracking-widest ml-1">3. å¾é›»è…¦ä¸Šå‚³æ–°åº•åœ– (é¸å¡«)</label>
                                    <div className="relative group">
                                        <input type="file" accept="image/*" onChange={handleImageUpload} className="absolute inset-0 opacity-0 cursor-pointer z-10" />
                                        <div className="bg-amber-600/10 border-2 border-dashed border-amber-500/30 rounded-2xl py-3 text-amber-400 text-center group-hover:bg-amber-600/20 transition-all flex items-center justify-center gap-2">
                                            <Icon name="image-plus" size={18} />
                                            é¸æ“‡æª”æ¡ˆ
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button onClick={downloadImage} disabled={!customBg} className={`w-full py-5 rounded-2xl shadow-xl font-black transition-all flex items-center justify-center gap-2 text-xl ${customBg ? 'bg-gradient-to-br from-amber-400 to-amber-600 text-red-950 hover:scale-105 active:scale-95' : 'bg-gray-800 text-gray-500 cursor-not-allowed'}`}>
                                <Icon name="download" size={24} />
                                ä¸‹è¼‰åå–®åœ–ç‰‡ (1920x1080)
                            </button>
                        </div>

                        <div className="bg-red-950/60 p-8 rounded-[2.5rem] border border-red-500/20 backdrop-blur-md flex flex-col">
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center gap-3">
                                    <Icon name="users" className="text-amber-400" size={24} />
                                    <h2 className="text-2xl font-black text-amber-400">ç·¨è¼¯åå–®</h2>
                                </div>
                            </div>
                            <textarea rows="15" className="flex-1 w-full bg-black/60 border border-white/5 rounded-2xl p-5 text-white focus:border-amber-500 outline-none font-mono text-base leading-relaxed custom-scrollbar shadow-inner" value={winnerText} onChange={(e) => setWinnerText(e.target.value)} placeholder="è«‹è²¼ä¸Šåå–®ï¼Œæ¯è¡Œä¸€ä½..." />
                        </div>
                    </div>

                    <div className="flex flex-col items-center">
                        <div className="mb-4 text-xs font-bold text-gray-500 uppercase tracking-widest flex items-center gap-2">
                            <Icon name="eye" size={14} /> ç•«å¸ƒè¼¸å‡ºé è¦½ (1920x1080)
                        </div>
                        <div className="w-full bg-black/40 rounded-[3rem] p-6 border border-white/5 flex justify-center overflow-hidden shadow-2xl">
                            <div className="w-full overflow-auto flex justify-center">
                                <div style={{ transform: 'scale(0.5)', transformOrigin: 'top center', width: '1920px', height: '1080px', flexShrink: 0 }}>
                                    <canvas ref={canvasRef} width={canvasSize.width} height={canvasSize.height} />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
